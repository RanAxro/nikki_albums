import "dart:async";
import "dart:ui" as ui;

import "package:flutter/foundation.dart";
import "package:flutter/material.dart";

class EmptyImageProvider extends ImageProvider<EmptyImageProvider>{
  @override
  Future<EmptyImageProvider> obtainKey(ImageConfiguration configuration){
    return SynchronousFuture<EmptyImageProvider>(this);
  }

  @override
  ImageStreamCompleter loadImage(EmptyImageProvider key, ImageDecoderCallback decode){
    return OneFrameImageStreamCompleter(
      _loadTransparentImage(),
    );
  }

  Future<ImageInfo> _loadTransparentImage() async{
    final Uint8List bytes = Uint8List.fromList([
      0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, 0x00, 0x00, 0x00, 0x0D,
      0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
      0x08, 0x06, 0x00, 0x00, 0x00, 0x1F, 0x15, 0xC4, 0x89, 0x00, 0x00, 0x00,
      0x0D, 0x49, 0x44, 0x41, 0x54, 0x08, 0x99, 0x01, 0x01, 0x00, 0x00, 0x00,
      0xFF, 0xFF, 0x00, 0x00, 0x00, 0x02, 0x00, 0x01, 0xE2, 0x21, 0xBC, 0x33,
      0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E, 0x44, 0xAE, 0x42, 0x60, 0x82,
    ]);

    final ui.Codec codec = await ui.instantiateImageCodec(bytes);
    final ui.FrameInfo frameInfo = await codec.getNextFrame();

    return ImageInfo(image: frameInfo.image);
  }
}